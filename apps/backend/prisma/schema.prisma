// apps/backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// 사용자 정보 (인증용)
model User {
  id              Int           @id @default(autoincrement())
  email           String        @unique
  password        String
  name            String
  refreshTokenHash String?
  reservations    Reservation[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

// 공연/이벤트
model Event {
  id          Int      @id @default(autoincrement())
  title       String
  date        DateTime
  seats       Seat[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 좌석
model Seat {
  id          Int          @id @default(autoincrement())
  seatNumber  String       // "A1", "B3" 등
  event       Event        @relation(fields: [eventId], references: [id])
  eventId     Int
  status      SeatStatus   @default(AVAILABLE)
  reservation Reservation?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@unique([eventId, seatNumber])
}

enum SeatStatus {
  AVAILABLE
  HELD
  RESERVED
}

// 예약 정보
model Reservation {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  seat      Seat     @relation(fields: [seatId], references: [id])
  seatId    Int      @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
